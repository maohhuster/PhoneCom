# ğŸ“Š BÃO CÃO Cáº¤U TRÃšC CHÆ¯Æ NG TRÃŒNH PHONECOM

**Dá»± Ã¡n:** PhoneCom - E-commerce quáº£n lÃ½ cá»­a hÃ ng Ä‘iá»‡n thoáº¡i  
**NgÃ y:** 2025-01-04  
**CÃ´ng nghá»‡:** React 19 + Node.js + Express + Prisma + PostgreSQL

---

## ğŸ—ï¸ Tá»”NG QUAN KIáº¾N TRÃšC

### **Kiáº¿n trÃºc tá»•ng thá»ƒ:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FRONTEND (Vercel)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   React 19   â”‚  â”‚   Vite       â”‚  â”‚  TypeScript  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         Context API (State Management)            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ HTTP/REST API
                        â”‚ (JSON)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   BACKEND (Render)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Express    â”‚  â”‚  TypeScript  â”‚  â”‚   Prisma     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Routes â†’ Controllers â†’ Services â†’ Database       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ Prisma ORM
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DATABASE (Neon PostgreSQL)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Users, Products, Orders, Cart, Inventory, etc.   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **CÃ´ng nghá»‡ sá»­ dá»¥ng:**

**Frontend:**
- React 19.2.3
- Vite 6.2.0 (Build tool)
- TypeScript 5.8.2
- Tailwind CSS (CDN)
- Context API (State management)

**Backend:**
- Node.js
- Express 4.21.2
- TypeScript 5.8.2
- Prisma 5.22.0 (ORM)
- CORS 2.8.5

**Database:**
- PostgreSQL (Neon Cloud)
- 10 Models (tables)

**AI Service:**
- Google Gemini AI (Chatbot)

---

## ğŸ“ Cáº¤U TRÃšC THÆ¯ Má»¤C

### **Cáº¥u trÃºc tá»•ng thá»ƒ:**
```
phonecom/
â”œâ”€â”€ backend/                    # Backend API
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ controllers/       # Business logic
â”‚   â”‚   â”œâ”€â”€ routes/            # API routes
â”‚   â”‚   â”œâ”€â”€ services/          # External services (AI)
â”‚   â”‚   â”œâ”€â”€ db.ts              # Prisma client
â”‚   â”‚   â””â”€â”€ index.ts           # Server entry point
â”‚   â”œâ”€â”€ prisma/
â”‚   â”‚   â”œâ”€â”€ schema.prisma      # Database schema
â”‚   â”‚   â”œâ”€â”€ seed.ts            # Dev seed
â”‚   â”‚   â””â”€â”€ seed.prod.ts       # Production seed
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ components/                 # React components
â”‚   â”œâ”€â”€ admin/                 # Admin components
â”‚   â”œâ”€â”€ auth/                  # Authentication
â”‚   â”œâ”€â”€ cart/                  # Shopping cart
â”‚   â”œâ”€â”€ common/                 # Shared components
â”‚   â”œâ”€â”€ home/                   # Home page
â”‚   â”œâ”€â”€ layout/                 # Layout components
â”‚   â”œâ”€â”€ orders/                # Order management
â”‚   â””â”€â”€ product/                # Product details
â”‚
â”œâ”€â”€ context/
â”‚   â””â”€â”€ AppContext.tsx         # Global state management
â”‚
â”œâ”€â”€ api.ts                     # API client (fetch wrapper)
â”œâ”€â”€ App.tsx                    # Root component
â”œâ”€â”€ types.ts                   # TypeScript types
â””â”€â”€ vite.config.ts             # Vite configuration
```

---

## ğŸ—„ï¸ DATABASE SCHEMA

### **Tá»•ng quan:**
- **10 Models** (tables)
- **Relationships:** One-to-Many, Many-to-One
- **Constraints:** Foreign keys, Unique constraints

### **Chi tiáº¿t Models:**

#### **1. Role (roles)**
```prisma
model Role {
  id          String   @id @default(uuid())
  name        String
  description String?
  permissions String[]
  users       User[]
}
```
**Chá»©c nÄƒng:** Quáº£n lÃ½ vai trÃ² ngÆ°á»i dÃ¹ng (CUSTOMER, STAFF, ADMIN, GUEST)

#### **2. User (users)**
```prisma
model User {
  id                 String        @id @default(uuid())
  roleId             String
  fullName           String
  email              String        @unique
  passwordHash       String?
  status             String        @default("ACTIVE")
  addresses          Address[]
  cart               Cart?
  orders             Order[]
  staffNotes         StaffNote[]
  // ... audit fields
}
```
**Chá»©c nÄƒng:** Quáº£n lÃ½ ngÆ°á»i dÃ¹ng, há»— trá»£ RBAC (Role-Based Access Control)

#### **3. Product (products)**
```prisma
model Product {
  id          String    @id @default(uuid())
  name        String
  brand       String
  description String?
  status      String
  imageUrl    String?
  variants    Variant[]
}
```
**Chá»©c nÄƒng:** Quáº£n lÃ½ sáº£n pháº©m Ä‘iá»‡n thoáº¡i

#### **4. Variant (variants)**
```prisma
model Variant {
  id            String        @id @default(uuid())
  productId     String
  name          String
  color         String
  capacity      String
  price         Decimal       @db.Decimal(10, 2)
  stockQuantity Int           @default(0)
  status        String
  cartItems     CartItem[]
  orderItems    OrderItem[]
  inventoryTxs  InventoryTx[]
}
```
**Chá»©c nÄƒng:** Quáº£n lÃ½ biáº¿n thá»ƒ sáº£n pháº©m (mÃ u sáº¯c, dung lÆ°á»£ng, giÃ¡)

#### **5. Cart & CartItem (carts, cart_items)**
```prisma
model Cart {
  id          String     @id @default(uuid())
  userId      String?    @unique
  totalItems  Int        @default(0)
  totalAmount Decimal    @default(0)
  cartItems   CartItem[]
}

model CartItem {
  id         String  @id @default(uuid())
  cartId     String
  variantId  String
  qty        Int     @default(1)
  unitPrice  Decimal
  lineAmount Decimal
}
```
**Chá»©c nÄƒng:** Quáº£n lÃ½ giá» hÃ ng vÃ  items trong giá»

#### **6. Order & OrderItem (orders, order_items)**
```prisma
model Order {
  id              String      @id @default(uuid())
  userId          String
  paymentMethod   String
  status          String      // PENDING, CONFIRMED, COMPLETED, CANCELLED
  subtotal        Decimal
  shippingFee     Decimal
  totalAmount     Decimal
  shippingAddress Json
  items           OrderItem[]
  staffNotes      StaffNote[]
  // ... audit timestamps
}

model OrderItem {
  id                  String  @id @default(uuid())
  orderId             String
  variantId           String
  variantNameSnapshot String  // Snapshot Ä‘á»ƒ giá»¯ giÃ¡ trá»‹ cÅ©
  unitPrice           Decimal
  quantity            Int
  lineTotal           Decimal
}
```
**Chá»©c nÄƒng:** Quáº£n lÃ½ Ä‘Æ¡n hÃ ng vá»›i workflow (PENDING â†’ CONFIRMED â†’ COMPLETED)

#### **7. Address (addresses)**
```prisma
model Address {
  id            String   @id @default(uuid())
  userId        String
  recipientName String
  line1         String
  ward          String
  district      String
  province      String
  phoneNumber   String
  isDefault     Boolean  @default(false)
}
```
**Chá»©c nÄƒng:** Quáº£n lÃ½ Ä‘á»‹a chá»‰ giao hÃ ng

#### **8. StaffNote (staff_notes)**
```prisma
model StaffNote {
  id        String   @id @default(uuid())
  orderId   String
  staffId   String
  content   String
  createdAt DateTime @default(now())
}
```
**Chá»©c nÄƒng:** Ghi chÃº ná»™i bá»™ cá»§a staff cho Ä‘Æ¡n hÃ ng

#### **9. InventoryTx (inventory_transactions)**
```prisma
model InventoryTx {
  id        String   @id @default(uuid())
  variantId String
  type      String   // RESTOCK, SALE, ADJUSTMENT
  quantity  Int
  reason    String
  createdBy String
  createdAt DateTime @default(now())
}
```
**Chá»©c nÄƒng:** Lá»‹ch sá»­ thay Ä‘á»•i tá»“n kho (audit trail)

---

## ğŸ”§ BACKEND ARCHITECTURE

### **Cáº¥u trÃºc Backend:**

```
backend/src/
â”œâ”€â”€ index.ts              # Server entry, middleware, routes setup
â”œâ”€â”€ db.ts                 # Prisma client singleton
â”‚
â”œâ”€â”€ routes/                # API Routes (RESTful)
â”‚   â”œâ”€â”€ users.ts
â”‚   â”œâ”€â”€ products.ts
â”‚   â”œâ”€â”€ variants.ts
â”‚   â”œâ”€â”€ cart.ts
â”‚   â”œâ”€â”€ orders.ts
â”‚   â”œâ”€â”€ addresses.ts
â”‚   â”œâ”€â”€ staffNotes.ts
â”‚   â”œâ”€â”€ inventory.ts
â”‚   â””â”€â”€ chat.ts
â”‚
â”œâ”€â”€ controllers/          # Business Logic
â”‚   â”œâ”€â”€ user.controller.ts
â”‚   â”œâ”€â”€ product.controller.ts
â”‚   â”œâ”€â”€ variant.controller.ts
â”‚   â”œâ”€â”€ cart.controller.ts
â”‚   â”œâ”€â”€ order.controller.ts
â”‚   â”œâ”€â”€ address.controller.ts
â”‚   â”œâ”€â”€ staffNote.controller.ts
â”‚   â”œâ”€â”€ inventory.controller.ts
â”‚   â””â”€â”€ chat.controller.ts
â”‚
â””â”€â”€ services/             # External Services
    â””â”€â”€ ai.ts             # Google Gemini AI integration
```

### **1. Server Entry Point (`index.ts`)**

**Chá»©c nÄƒng:**
- Khá»Ÿi táº¡o Express server
- Cáº¥u hÃ¬nh middleware (CORS, JSON parser)
- ÄÄƒng kÃ½ routes
- Error handling
- Health check endpoint

**CÃ¡c hÃ m chÃ­nh:**
```typescript
// Middleware
app.use(cors({ ... }))      // CORS configuration
app.use(express.json())     // JSON parser

// Routes
app.use('/api/users', usersRouter)
app.use('/api/products', productsRouter)
// ... 9 routes total

// Health check
app.get('/health', (req, res) => { ... })
```

### **2. Routes (RESTful API)**

**Pattern:** `routes/[resource].ts`

**VÃ­ dá»¥: `routes/products.ts`**
```typescript
router.post('/', productController.createProduct)      // POST /api/products
router.get('/', productController.getAllProducts)      // GET /api/products
router.get('/:id', productController.getProductById)  // GET /api/products/:id
router.put('/:id', productController.updateProduct)  // PUT /api/products/:id
router.delete('/:id', productController.deleteProduct) // DELETE /api/products/:id
```

**Táº¥t cáº£ Routes:**
- `/api/users` - User management
- `/api/products` - Product CRUD
- `/api/variants` - Variant management
- `/api/cart` - Shopping cart operations
- `/api/orders` - Order management
- `/api/addresses` - Address management
- `/api/staff-notes` - Staff notes CRUD
- `/api/inventory` - Inventory transactions
- `/api/chat` - AI chatbot

### **3. Controllers (Business Logic)**

**Pattern:** `controllers/[resource].controller.ts`

**VÃ­ dá»¥: `controllers/product.controller.ts`**

**CÃ¡c hÃ m:**
```typescript
// Táº¡o sáº£n pháº©m má»›i
createProduct(req, res) {
  - Validate input
  - Create product vá»›i variants (nested create)
  - Return product vá»›i variants
}

// Láº¥y táº¥t cáº£ sáº£n pháº©m
getAllProducts(req, res) {
  - Query products vá»›i variants
  - Order by createdAt desc
  - Return array
}

// Láº¥y sáº£n pháº©m theo ID
getProductById(req, res) {
  - Find unique product
  - Include variants
  - Return 404 náº¿u khÃ´ng tÃ¬m tháº¥y
}

// Cáº­p nháº­t sáº£n pháº©m
updateProduct(req, res) {
  - Update product fields
  - Return updated product
}

// XÃ³a sáº£n pháº©m
deleteProduct(req, res) {
  - Delete product (cascade variants)
  - Return 204
}
```

**Táº¥t cáº£ Controllers:**
- `user.controller.ts` - User CRUD, role management
- `product.controller.ts` - Product CRUD
- `variant.controller.ts` - Variant update, stock management
- `cart.controller.ts` - Add/update/remove cart items
- `order.controller.ts` - Create order, update status, workflow
- `address.controller.ts` - Address CRUD
- `staffNote.controller.ts` - Staff notes CRUD
- `inventory.controller.ts` - Inventory transactions history
- `chat.controller.ts` - AI chatbot integration

### **4. Services**

**File: `services/ai.ts`**

**Chá»©c nÄƒng:** TÃ­ch há»£p Google Gemini AI cho chatbot

**HÃ m chÃ­nh:**
```typescript
getChatResponse(userMessage, history) {
  1. Fetch products tá»« database
  2. Format product context
  3. Initialize Gemini model vá»›i system instruction
  4. Send message vá»›i history
  5. Return AI response
}
```

### **5. Database Client (`db.ts`)**

**Chá»©c nÄƒng:**
- Prisma Client singleton
- Connection test khi start
- Logging configuration

**Code:**
```typescript
export const prisma = new PrismaClient({
  log: process.env.NODE_ENV === 'development' 
    ? ['query', 'error', 'warn'] 
    : ['error'],
});

// Test connection on startup
prisma.$connect()
  .then(() => console.log('âœ… Database connected'))
  .catch((error) => console.error('âŒ Database connection failed:', error));
```

---

## ğŸ¨ FRONTEND ARCHITECTURE

### **Cáº¥u trÃºc Frontend:**

```
frontend/
â”œâ”€â”€ App.tsx                    # Root component
â”œâ”€â”€ index.tsx                  # Entry point
â”œâ”€â”€ api.ts                     # API client (fetch wrapper)
â”œâ”€â”€ types.ts                   # TypeScript interfaces
â”‚
â”œâ”€â”€ context/
â”‚   â””â”€â”€ AppContext.tsx         # Global state management
â”‚
â””â”€â”€ components/
    â”œâ”€â”€ layout/                # Layout components
    â”‚   â”œâ”€â”€ Header.tsx
    â”‚   â”œâ”€â”€ MainContent.tsx
    â”‚   â””â”€â”€ ToastContainer.tsx
    â”‚
    â”œâ”€â”€ home/                  # Home page
    â”‚   â”œâ”€â”€ HeroSection.tsx
    â”‚   â””â”€â”€ ProductList.tsx
    â”‚
    â”œâ”€â”€ product/               # Product details
    â”‚   â””â”€â”€ ProductDetail.tsx
    â”‚
    â”œâ”€â”€ cart/                  # Shopping cart
    â”‚   â”œâ”€â”€ CartView.tsx
    â”‚   â””â”€â”€ CheckoutView.tsx
    â”‚
    â”œâ”€â”€ orders/                # Order management
    â”‚   â””â”€â”€ OrderHistory.tsx
    â”‚
    â”œâ”€â”€ auth/                  # Authentication
    â”‚   â”œâ”€â”€ LoginView.tsx
    â”‚   â””â”€â”€ RegisterView.tsx
    â”‚
    â”œâ”€â”€ admin/                 # Admin dashboard
    â”‚   â””â”€â”€ StaffDashboard.tsx
    â”‚
    â””â”€â”€ common/                # Shared components
        â””â”€â”€ ChatBot.tsx        # AI Chatbot
```

### **1. State Management (`context/AppContext.tsx`)**

**Chá»©c nÄƒng:** Quáº£n lÃ½ global state cho toÃ n bá»™ á»©ng dá»¥ng

**State:**
```typescript
interface AppState {
  currentUser: User | null;      // User hiá»‡n táº¡i
  allUsers: User[];              // Táº¥t cáº£ users (admin)
  products: Product[];            // Danh sÃ¡ch sáº£n pháº©m
  cart: CartItem[];              // Giá» hÃ ng
  orders: Order[];                // ÄÆ¡n hÃ ng
  view: string;                   // View hiá»‡n táº¡i
  currentProduct: Product | null;  // Sáº£n pháº©m Ä‘ang xem
  notifications: Notification[];   // Toast notifications
}
```

**CÃ¡c hÃ m chÃ­nh:**
```typescript
// Authentication
login(email, role)              // ÄÄƒng nháº­p
register(fullName, email, password) // ÄÄƒng kÃ½
logout()                         // ÄÄƒng xuáº¥t

// Cart Management
addToCart(variant, product)      // ThÃªm vÃ o giá»
removeFromCart(itemId)           // XÃ³a khá»i giá»
updateCartQty(itemId, delta)    // Cáº­p nháº­t sá»‘ lÆ°á»£ng

// Order Management
placeOrder(shippingAddress)      // Äáº·t hÃ ng
updateOrderStatus(orderId, status, note) // Cáº­p nháº­t tráº¡ng thÃ¡i

// Product Management
updateProduct(productId, data)  // Cáº­p nháº­t sáº£n pháº©m
addProduct(productData)          // ThÃªm sáº£n pháº©m
deleteProduct(productId)         // XÃ³a sáº£n pháº©m
updateVariant(variantId, data)   // Cáº­p nháº­t variant

// Inventory Management
updateInventory(variantId, newStock) // Cáº­p nháº­t tá»“n kho

// Staff Notes
addStaffNote(orderId, content)   // ThÃªm ghi chÃº
editStaffNote(noteId, content)   // Sá»­a ghi chÃº
deleteStaffNote(noteId)          // XÃ³a ghi chÃº

// UI
setView(view)                    // Chuyá»ƒn view
setCurrentProduct(product)       // Set sáº£n pháº©m hiá»‡n táº¡i
showNotification(message, type)   // Hiá»ƒn thá»‹ thÃ´ng bÃ¡o
```

### **2. API Client (`api.ts`)**

**Chá»©c nÄƒng:** Wrapper cho fetch API, xá»­ lÃ½ errors

**Cáº¥u trÃºc:**
```typescript
const API_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:3001/api';

export const api = {
  users: {
    create, getAll, getById, getCart, getOrders, getAddresses, update
  },
  products: {
    getAll, getById, create, update, delete
  },
  variants: {
    update
  },
  cart: {
    add, updateQty, remove, clearParams
  },
  orders: {
    create, getAll, updateStatus
  },
  addresses: {
    create
  },
  staffNotes: {
    create, update, delete
  },
  inventory: {
    getTransactions
  },
  chat: {
    sendMessage
  }
};
```

**Helper function:**
```typescript
handleResponse<T>(response) {
  - Check response.ok
  - Parse JSON
  - Throw error náº¿u cÃ³ lá»—i
  - Return typed data
}
```

### **3. Components**

#### **Layout Components:**

**`Header.tsx`**
- Navigation bar
- User menu (login/logout)
- Cart icon vá»›i badge
- Role-based menu items

**`MainContent.tsx`**
- Router logic (view switching)
- Render components dá»±a trÃªn `view` state

**`ToastContainer.tsx`**
- Hiá»ƒn thá»‹ notifications
- Auto-dismiss sau 3 giÃ¢y

#### **Home Components:**

**`HeroSection.tsx`**
- Hero banner
- Call-to-action buttons

**`ProductList.tsx`**
- Grid layout sáº£n pháº©m
- Product cards vá»›i image, name, price
- Click Ä‘á»ƒ xem chi tiáº¿t

#### **Product Components:**

**`ProductDetail.tsx`**
- Product information
- Variant selector (color, capacity)
- Add to cart button
- Stock status

#### **Cart Components:**

**`CartView.tsx`**
- Danh sÃ¡ch items trong giá»
- Update quantity
- Remove items
- Total calculation
- Checkout button

**`CheckoutView.tsx`**
- Address selection/input
- Order summary
- Payment method selection
- Place order button

#### **Order Components:**

**`OrderHistory.tsx`**
- Danh sÃ¡ch Ä‘Æ¡n hÃ ng cá»§a user
- Order status badges
- Order details modal

#### **Auth Components:**

**`LoginView.tsx`**
- Email input
- Role selection (demo)
- Login button

**`RegisterView.tsx`**
- Full name, email, password inputs
- Register button

#### **Admin Components:**

**`StaffDashboard.tsx`**
- Order management table
- Status update buttons
- Staff notes editor
- Inventory management
- Product management
- User management
- Statistics charts

#### **Common Components:**

**`ChatBot.tsx`**
- AI chatbot interface
- Message history
- Send message input
- Integration vá»›i Gemini AI

---

## ğŸ”„ WORKFLOWS VÃ€ BUSINESS LOGIC

### **1. Order Workflow**

```
PENDING â†’ CONFIRMED â†’ COMPLETED
   â†“
CANCELLED
```

**States:**
- **PENDING:** ÄÆ¡n hÃ ng má»›i táº¡o, chÆ°a xá»­ lÃ½
- **CONFIRMED:** Staff Ä‘Ã£ xÃ¡c nháº­n, trá»« tá»“n kho
- **COMPLETED:** ÄÃ£ giao hÃ ng thÃ nh cÃ´ng
- **CANCELLED:** ÄÃ£ há»§y (bá»Ÿi user hoáº·c staff)

**Functions:**
```typescript
// Táº¡o Ä‘Æ¡n hÃ ng
placeOrder(shippingAddress) {
  1. Validate cart khÃ´ng rá»—ng
  2. Check stock availability
  3. Create order vá»›i items
  4. Clear cart
  5. Show success notification
}

// Cáº­p nháº­t tráº¡ng thÃ¡i (Staff)
updateOrderStatus(orderId, status) {
  1. Update order status
  2. Náº¿u CONFIRMED: Trá»« tá»“n kho
  3. Táº¡o inventory transaction
  4. Update timestamps (confirmedAt, completedAt, etc.)
}
```

### **2. Inventory Workflow**

**Transaction Types:**
- **RESTOCK:** Nháº­p hÃ ng
- **SALE:** BÃ¡n hÃ ng (khi confirm order)
- **ADJUSTMENT:** Äiá»u chá»‰nh

**Functions:**
```typescript
// Cáº­p nháº­t tá»“n kho
updateInventory(variantId, newStock) {
  1. Calculate quantity change
  2. Update variant.stockQuantity
  3. Create InventoryTx record
  4. Update variant status (IN_STOCK/OUT_OF_STOCK)
}
```

### **3. Cart Workflow**

**Functions:**
```typescript
// ThÃªm vÃ o giá»
addToCart(variant, product) {
  1. Check náº¿u variant Ä‘Ã£ cÃ³ trong giá»
  2. Náº¿u cÃ³: TÄƒng quantity
  3. Náº¿u khÃ´ng: ThÃªm item má»›i
  4. Update cart totals
  5. Sync vá»›i backend
}

// Cáº­p nháº­t sá»‘ lÆ°á»£ng
updateCartQty(itemId, delta) {
  1. Find cart item
  2. Update quantity
  3. Validate stock availability
  4. Update line amount
  5. Update cart totals
}
```

### **4. RBAC (Role-Based Access Control)**

**Roles:**
- **GUEST:** Chá»‰ xem sáº£n pháº©m
- **CUSTOMER:** Mua hÃ ng, xem Ä‘Æ¡n hÃ ng
- **STAFF:** Quáº£n lÃ½ Ä‘Æ¡n hÃ ng, tá»“n kho
- **ADMIN:** ToÃ n quyá»n

**Permission Check:**
```typescript
// Frontend
if (currentUser?.role.name === 'ADMIN' || currentUser?.role.name === 'STAFF') {
  // Show admin features
}

// Backend (cÃ³ thá»ƒ thÃªm middleware)
// Hiá»‡n táº¡i chÆ°a cÃ³ authentication middleware
// CÃ³ thá»ƒ thÃªm JWT authentication sau
```

---

## ğŸ“¡ API ENDPOINTS

### **Users API:**
- `GET /api/users` - Láº¥y táº¥t cáº£ users
- `GET /api/users/:id` - Láº¥y user theo ID
- `POST /api/users` - Táº¡o user má»›i
- `PUT /api/users/:id` - Cáº­p nháº­t user
- `GET /api/users/:id/cart` - Láº¥y giá» hÃ ng cá»§a user
- `GET /api/users/:id/orders` - Láº¥y Ä‘Æ¡n hÃ ng cá»§a user
- `GET /api/users/:id/addresses` - Láº¥y Ä‘á»‹a chá»‰ cá»§a user

### **Products API:**
- `GET /api/products` - Láº¥y táº¥t cáº£ sáº£n pháº©m
- `GET /api/products/:id` - Láº¥y sáº£n pháº©m theo ID
- `POST /api/products` - Táº¡o sáº£n pháº©m má»›i
- `PUT /api/products/:id` - Cáº­p nháº­t sáº£n pháº©m
- `DELETE /api/products/:id` - XÃ³a sáº£n pháº©m
- `POST /api/products/:productId/variants` - ThÃªm variant

### **Variants API:**
- `PUT /api/variants/:id` - Cáº­p nháº­t variant (giÃ¡, tá»“n kho)

### **Cart API:**
- `POST /api/cart` - ThÃªm vÃ o giá»
- `PUT /api/cart/:id` - Cáº­p nháº­t sá»‘ lÆ°á»£ng
- `DELETE /api/cart/:id` - XÃ³a khá»i giá»
- `DELETE /api/cart/user/:userId` - XÃ³a toÃ n bá»™ giá»

### **Orders API:**
- `GET /api/orders` - Láº¥y táº¥t cáº£ Ä‘Æ¡n hÃ ng (cÃ³ thá»ƒ filter by status)
- `POST /api/orders` - Táº¡o Ä‘Æ¡n hÃ ng má»›i
- `PUT /api/orders/:id/status` - Cáº­p nháº­t tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng

### **Addresses API:**
- `POST /api/addresses` - Táº¡o Ä‘á»‹a chá»‰ má»›i

### **Staff Notes API:**
- `POST /api/staff-notes` - Táº¡o ghi chÃº
- `PUT /api/staff-notes/:id` - Cáº­p nháº­t ghi chÃº
- `DELETE /api/staff-notes/:id` - XÃ³a ghi chÃº

### **Inventory API:**
- `GET /api/inventory/transactions` - Láº¥y lá»‹ch sá»­ giao dá»‹ch tá»“n kho

### **Chat API:**
- `POST /api/chat` - Gá»­i message Ä‘áº¿n AI chatbot

### **Health Check:**
- `GET /health` - Health check endpoint
- `GET /` - Root endpoint

---

## ğŸ¯ CÃC TÃNH NÄ‚NG CHÃNH

### **1. Customer Features:**
- âœ… Duyá»‡t sáº£n pháº©m (danh sÃ¡ch, chi tiáº¿t)
- âœ… ThÃªm vÃ o giá» hÃ ng
- âœ… Quáº£n lÃ½ giá» hÃ ng (update quantity, remove)
- âœ… Checkout (chá»n Ä‘á»‹a chá»‰, Ä‘áº·t hÃ ng)
- âœ… Xem lá»‹ch sá»­ Ä‘Æ¡n hÃ ng
- âœ… AI Chatbot (tÆ° váº¥n sáº£n pháº©m)

### **2. Staff Features:**
- âœ… Dashboard quáº£n lÃ½ Ä‘Æ¡n hÃ ng
- âœ… Cáº­p nháº­t tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng
- âœ… Quáº£n lÃ½ tá»“n kho
- âœ… ThÃªm/sá»­a ghi chÃº cho Ä‘Æ¡n hÃ ng
- âœ… Xem thá»‘ng kÃª (charts)

### **3. Admin Features:**
- âœ… Táº¥t cáº£ tÃ­nh nÄƒng cá»§a Staff
- âœ… Quáº£n lÃ½ users (CRUD)
- âœ… Thay Ä‘á»•i role cá»§a user
- âœ… Quáº£n lÃ½ sáº£n pháº©m (CRUD)
- âœ… Quáº£n lÃ½ variants (update price, stock)

---

## ğŸ” SECURITY & BEST PRACTICES

### **ÄÃ£ implement:**
- âœ… CORS configuration
- âœ… Input validation (Prisma)
- âœ… Error handling middleware
- âœ… TypeScript type safety
- âœ… Environment variables

### **CÃ³ thá»ƒ cáº£i thiá»‡n:**
- âš ï¸ JWT Authentication (hiá»‡n táº¡i chÆ°a cÃ³)
- âš ï¸ Password hashing (hiá»‡n táº¡i chÆ°a cÃ³)
- âš ï¸ Rate limiting
- âš ï¸ Input sanitization
- âš ï¸ SQL injection protection (Prisma Ä‘Ã£ handle)

---

## ğŸ“Š STATISTICS

### **Code Statistics:**
- **Backend Routes:** 9 routes
- **Backend Controllers:** 9 controllers
- **Frontend Components:** 15+ components
- **Database Models:** 10 models
- **API Endpoints:** 30+ endpoints
- **TypeScript Files:** 25+ files

### **Features:**
- **User Roles:** 4 roles (GUEST, CUSTOMER, STAFF, ADMIN)
- **Order Statuses:** 4 statuses (PENDING, CONFIRMED, COMPLETED, CANCELLED)
- **Inventory Transaction Types:** 3 types (RESTOCK, SALE, ADJUSTMENT)

---

## ğŸ‰ Káº¾T LUáº¬N

Dá»± Ã¡n PhoneCom Ä‘Æ°á»£c xÃ¢y dá»±ng vá»›i:
- âœ… **Kiáº¿n trÃºc rÃµ rÃ ng:** Separation of concerns (Routes â†’ Controllers â†’ Database)
- âœ… **Type Safety:** TypeScript toÃ n bá»™ codebase
- âœ… **Scalable:** Dá»… má»Ÿ rá»™ng thÃªm features
- âœ… **Maintainable:** Code structure dá»… Ä‘á»c, dá»… maintain
- âœ… **Modern Stack:** React 19, Node.js, Prisma, PostgreSQL

**Äiá»ƒm máº¡nh:**
- Clean architecture
- RESTful API design
- Context API cho state management
- Prisma ORM cho type-safe database access
- AI integration (Gemini)

**CÃ³ thá»ƒ cáº£i thiá»‡n:**
- Authentication & Authorization (JWT)
- Password hashing
- API rate limiting
- Unit tests & Integration tests
- Error logging service

---

**BÃ¡o cÃ¡o Ä‘Æ°á»£c táº¡o bá»Ÿi:** AI Assistant  
**NgÃ y:** 2025-01-04

